<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/student_dashboard.css') }}">
</head>
<body>
  <div class="container">

    <div class="main-content">

      <header>
        <div class="header-left">
          <h1>Welcome, {{ user.name }} (Student)</h1>
        </div>
        <a href="{{ url_for('logout') }}" class="logout-btn">Logout</a>
      </header>

      <main>

        <section class="hero">
          <h2>ðŸš€ Your Project Dashboard</h2>
          <p>Manage and track your submissions easily with AI insights.</p>
        </section>
        
        <div class="dashboard-grid">

          <!-- Project Source Code Card -->
         <!-- Source Code Upload (.zip) -->
        <div class="card">
        <h2>Source Code Upload</h2>
        <form onsubmit="uploadFile(event, '/upload_source_code', 'source_code', 'sourceStatus')" enctype="multipart/form-data">
        <input type="file" name="source_code" accept=".zip" required>
        <button type="submit">Upload</button>
        </form>
        <p class="status" id="sourceStatus">Status: {{ user.source_code_status or 'Not Uploaded' }}</p>
        </div>

          <!-- Project Video Card -->
          <div class="card">
            <h2>Project Video</h2>
            <form onsubmit="uploadFile(event, '/upload_video', 'video', 'videoStatus')" enctype="multipart/form-data">
              <input type="file" name="video" accept=".mp4" required>
              <button type="submit">Upload</button>
            </form>
            <p class="status" id="videoStatus">Status: {{ user.video_status or 'Not Uploaded' }}</p>
          </div>

          <!-- PPT Card -->
           <!-- PPT Upload (.ppt, .pptx) -->
          <div class="card">
            <h2>PPT Submission</h2>
            <form onsubmit="uploadFile(event, '/upload_ppt', 'ppt', 'pptStatus')" enctype="multipart/form-data">
              <input type="file" name="ppt" accept=".ppt,.pptx" required>
              <button type="submit">Upload</button>
            </form>
            <p class="status" id="pptStatus">Status: {{ user.ppt_status or 'Not Uploaded' }}</p>
          </div>
          

          <!-- Project Report Card -->
          <!-- Project Report Upload (.pdf) -->
         <div class="card">
         <h2>Project Report</h2>
        <form onsubmit="uploadFile(event, '/upload_report', 'report', 'reportStatus')" enctype="multipart/form-data">
        <input type="file" name="report" accept=".pdf" required>
        <button type="submit">Upload</button>
        </form>
        <p class="status" id="reportStatus">Status: {{ user.report_status or 'Not Uploaded' }}</p>
        </div>

          <!-- Project Synopsis Card -->
          <!-- Project Synopsis Upload (.pdf) -->
        <div class="card">
        <h2>Project Synopsis</h2>
        <form onsubmit="uploadFile(event, '/upload_synopsis', 'synopsis', 'synopsisStatus')" enctype="multipart/form-data">
        <input type="file" name="synopsis" accept=".pdf" required>
        <button type="submit">Upload</button>
        </form>
        <p class="status" id="synopsisStatus">Status: {{ user.synopsis_status or 'Not Uploaded' }}</p>
         </div>

         <!-- Doubt/Chat Card -->
<<!-- Doubtâ€¯/â€¯Chat Card -->
<div class="card chat-card" id="chatCard">
  <h2>Ask a Doubt</h2>

  <!-- Toggle Button -->
  <button type="button" id="toggleChat" class="toggle-chat-btn">
    ðŸ’¬ Chat with Mentor
  </button>

  <!-- Chat body â€“ hidden until the button is pressed -->
  <div class="chat-body" id="chatBody">
    <div class="chat-box" style="max-height: 300px; overflow-y: auto;">
      {% for msg in messages %}
        <div class="message" style="margin-bottom: 10px;">
          <strong>
            {% if msg.student_id == user.id %}
              You:
            {% else %}
              Mentor:
            {% endif %}
          </strong> {{ msg.content }}
          <br>
          <small>{{ msg.timestamp.strftime('%Y-%m-%d %H:%M') }}</small>
        </div>
      {% else %}
        <div class="message">No messages yet.</div>
      {% endfor %}
    </div>

    {% if user.mentor_id %}
    <form action="/send_message" method="POST" style="margin-top: 10px;">
      <input type="hidden" name="mentor_id" value="{{ user.mentor_id }}">
      <textarea name="message" placeholder="Type your message here..." required></textarea>
      <button type="submit">Send</button>
    </form>
  </div>
</div>
<a href="{{ url_for('student_chat', mentor_id=user.mentor_id) }}" class="card-link-btn">ðŸ’¬ Open Chat</a>
    {% else %}
    <div class="message" style="text-align: center; color: #666; margin-top: 10px;">
      <p>No mentor assigned yet. Please wait for an admin to assign you a mentor.</p>
    </div>
  </div>
</div>
    {% endif %}


        </div>
      </main>
    </div>

  </div>

  <script>
    function uploadFile(event, url, inputName, statusId) {
      event.preventDefault();
      const form = event.target;
      const fileInput = form.querySelector(`input[name="${inputName}"]`);
      const status = document.getElementById(statusId);

      if (!fileInput.files.length) {
        status.textContent = 'Status: No file selected âŒ';
        return;
      }

      const formData = new FormData();
      formData.append(inputName, fileInput.files[0]);

      fetch(url, {
        method: 'POST',
        body: formData
      })
      .then(response => response.text())
      .then(data => {
        if (data === 'Success') {
          status.textContent = 'Status: Uploaded Successfully âœ…';
        } else {
          status.textContent = 'Status: Upload Failed âŒ';
        }
      })
      .catch(err => {
        status.textContent = 'Status: Upload Failed âŒ';
      });
    }

     // Simple toggle for the chat box
  document.getElementById('toggleChat').addEventListener('click', () => {
    const body = document.getElementById('chatBody');
    body.style.display = body.style.display === 'none' || body.style.display === '' ? 'block' : 'none';
  });
  </script>
</body>
</html>
